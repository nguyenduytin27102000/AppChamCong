@model IEnumerable<TimeKeeping.Models.CheckinWithView>

@{
    ViewData["Title"] = "Index";

}
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<style>
    #tsTime {
        color: red;
        font-size: large;
    }

    #quickSearch {
        padding-left: 40px;
    }

    i.icon {
        position: absolute;
        padding: 5px;
    }

    #table {
        background-color: #caf4ed;
    }

    #dayofweek {
        font-size: 26px;
        color: blue;
        text-shadow: 2px 2px 4px #000000;
    }
</style>

<h1 class="text-center">Person Timesheet</h1>

<div class="form-group">
    <i class="fas fa-search icon" style="font-size:26px; "></i>
    <!--This is for "not found"" when model.count = 0, it mean not any data. Different if else is onkeyup="quickSearch()" -->
    @{
        if (Model.Count() == 0)
        {
            <input type="text" id="quickSearch" placeholder="Search for date.." title="Type in a date" class="form-control  mr-2">
        }
        else
        {
            <input type="text" id="quickSearch" onkeyup="quickSearch()" placeholder="Search for date.." title="Type in a date" class="form-control  mr-2">
        }
    }
    <label for="month" class="mr-2 text-bolb" form="timeform"><strong>Month: </strong></label>
    <select id="month" name="month" class="form-control mr-2" form="timeform">
        @{
            for (int i = 1; i <= 12; i++)
            {
                if (i == ViewBag.Month)
                {
                    <option selected>@i</option>
                }
                <option>@i</option>
            }
        }
    </select>
    <label for="year" class="mr-2" form="timeform"> <strong>Year: </strong></label>
    <select id="year" name="year" class="form-control mr-2" form="timeform">
        <!--Year range between 1990 2025.-->
        @{

            for (int i = 1990; i <= 2025; i++)
            {
                if (i == ViewBag.Year)
                {
                    <option selected>@i</option>
                }
                <option>@i</option>
            }
        }
    </select>
</div>
<form asp-action="Index" asp-controller="Checkins" method="GET" class="form-inline" id="timeform">

    <div class="form-group">
        <input type="text" id="id" name="id" value="@ViewBag.Id" class="form-control" hidden>
    </div>
    <div class="form-group">
        <input type="submit" value="Go" class="btn btn-primary" />
    </div>
</form>
<!--<p id="tsTime">Timesheet of @ViewBag.Month-@ViewBag.Year</p>-->
<table class="table  table-striped table-bordered" id="table">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Time)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Personnal)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.WorkScheduleName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.MinutesLate)
            </th>

            <th hidden>
                @Html.DisplayNameFor(model => model.Regulations)
            </th>
            <th hidden>
                @Html.DisplayNameFor(model => model.DayOff)
            </th>
            <th>
                Action
            </th>
        </tr>
    </thead>
    <tbody>
        @{
            var count = 0;
            double totalMinuteLates = 0;


            if (Model.Count() == 0)
            {
                <tr>
                    <td colspan="5" class="text-center"><strong>Not found</strong></td>
                </tr>
            }
            else
            {
                <tr style="display:none">
                    <td colspan="5" class="text-center"><strong>Not found</strong></td>
                </tr>
            }

        }
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Time)<br>
                    <strong id="dayofweek"> @item.Time.DayOfWeek</strong>
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Personnal)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.WorkScheduleName)
                </td>
                <!--we only need time so we format time -->
                @{
                    String tc = @item.Time.ToString("hh:mm tt");
                    String ts = @item.StartTime.ToString("hh:mm tt");
                    DateTime timeCheckin = DateTime.Parse(tc, System.Globalization.CultureInfo.CurrentCulture);
                    DateTime timeStart = DateTime.Parse(ts, System.Globalization.CultureInfo.CurrentCulture);
                    double minutesLate = (timeCheckin.Subtract(timeStart).TotalMinutes);
                    if (minutesLate > @item.MinutesLate)
                    {

                        <td>You late: @minutesLate</td>
                        if (@item.DayOff != true)
                            totalMinuteLates = totalMinuteLates + minutesLate;
                    }
                    else
                    {
                        <td>You not late</td>
                    }
                }

                <td hidden>
                    @Html.DisplayFor(modelItem => item.Regulations)
                </td>

                <td hidden>
                    @Html.DisplayFor(modelItem => item.DayOff)
                </td>

                <td>
                    <a class="btn btn-primary" asp-controller="FeedbackCheckin" asp-action="Feedback" asp-route-id="@item.CheckinId">Feedback</a>
                </td>
            </tr>
            if (@item.DayOff != true)
                count = count + 1;
        }
        <tr>
            <h2>Your total shifts: <span style="color:red;">@count </span> . Your total minutes late: <span style="color:red;"> @totalMinuteLates </span> </h2>
        </tr>
    </tbody>
</table>
<script>
    function quickSearch() {
      var input, filter, table, tr, td, i, txtValue, count;
      count = 0;
      input = document.getElementById("quickSearch");
      filter = input.value.toUpperCase();
      table = document.getElementById("table");
      tr = table.getElementsByTagName("tr");
      for (i = 2; i < tr.length; i++) {
        td = tr[i].getElementsByTagName("td")[0];
        if (td) {
          txtValue = td.textContent || td.innerText;
          if (txtValue.toUpperCase().indexOf(filter) > -1) {
            tr[i].style.display = "";
            count = count + 1;
          } else {
            tr[i].style.display = "none";
          }
        }
      }
      if(count>0)
      {
      tr[1].style.display = "none";
      } else {
           tr[1].style.display = "";
      }

    }


</script>